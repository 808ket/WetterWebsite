<!DOCTYPE html>
<html>
<head>

    <meta name="viewport" content="width=device-width" />
    <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    />

    <link
            rel="stylesheet"
            href = "../css/style.css"
    />

    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
    >
    <title><%= subject %></title>
</head>

<body>
<div>
    <h1 class="heading">Wetter Daten</h1>
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col">
            <div class="city-name-style">
                <h3 class="city-name" data-name="stadtname">Mein Standort</h3>
                <form>
                    <span>Stadtname</span>
                    <span class="city-temp">
                    <i class="bi-thermometer-half"></i>Temperatur in <sup>°C</sup>
                    </span>
                </form>
                <div class="weather-city-situation">
                    <h4 class="city-title-weather-situation">
                        sonnig
                    </h4>
                    <i class="bi-sun"></i>
                </div>
            </div>
        </div>
        <div class="col">
            <form onsubmit="event.preventDefault(); getWeather();">
                <input style="outline: none; border: 2px solid green;" id="cityInput" type="text" placeholder="Stadt eingeben..." autofocus>
                <button type="submit">SUCHE</button>
            </form>
        </div>
        <div class="w-100"></div>
        <div class="col">
            <div class="wanted-city-name-style">
                <h3 class="wanted-city-name" data-name="gesuchte_stadtname"></h3>
                <form>
                    <span id="cityOutput"></span>
                    <span class="wanted-city-temp">
                        <i class="bi-thermometer-half"></i><sup>°C</sup>
                    </span>
                    <p id="temperatureOutput"></p>
                </form>
                <div class="weather-city-situation">
                    <h4 class="city-title-weather-situation" id="descriptionOutput"></h4>
                    <img id="weatherIcon" />
                </div>
            </div>
        </div>

        <div class="col">
            <div id="e6k8hv4n"></div>
            <script language="JavaScript" type="text/javascript">
                function loadMapz() {
                    var myMapz = document.createElement("iframe");
                    myMapz.setAttribute("src", "http://www.mapz.com/embedded/map/e6k8hv4n?lon=6.955443432150475&lat=50.91923397843401518&zoom=16");
                    myMapz.style.width = "450px";
                    myMapz.style.height = "450px";
                    var element = document.getElementById('e6k8hv4n')
                    element.appendChild(myMapz); }
                loadMapz()
            </script>
        </div>
    </div>
</div>
<script language="JavaScript" type="text/javascript">
    function loadMapz() {
        var myMapz = document.createElement("iframe");
        myMapz.setAttribute("src", "http://www.mapz.com/embedded/map/e6k8hv4n?lon=6.955443432150475&lat=50.91923397843401518&zoom=16";);
        myMapz.style.width = "450px";
        myMapz.style.height = "450px";
        var element = document.getElementById('e6k8hv4n')
        element.appendChild(myMapz);
    }
    loadMapz();
</script>
</div>
</div>
</div>
<script>
    async function getWeather() {
        const city = document.getElementById('cityInput').value;
        const apiKey = 'a1e5d59fc6cd95597863a081482de30e';
        const apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;

        try {
            const response = await fetch(apiUrl);
            if (!response.ok) {
                throw new Error('Netzwerkantwort war nicht ok ' + response.statusText);
            }
            const weatherData = await response.json();
            displayTemperature(weatherData);
            displayDescription(weatherData);
            displayCity(weatherData);
        } catch (error) {
            console.error('Es gab ein Problem mit der Fetch-Operation:', error);
            document.getElementById('weatherOutput').textContent = 'Fehler: ' + error.message;
        }
    }

    function displayTemperature(data) {
        const temperatureOutput = document.getElementById('temperatureOutput');
        const temperature = data.main.temp;
        temperatureOutput.textContent = `Temperatur: ${temperature}°C`;
    }

    function displayDescription(data) {
        const descriptionOutput = document.getElementById('descriptionOutput');
        const description = data.weather[0].description;
        descriptionOutput.textContent = `Wetter: ${description}`;
    }

    function displayCity(data) {
        const cityOutput = document.getElementById('cityOutput');
        cityOutput.textContent = `Gesuchte Stadt: ${data.name}`;
    }
</script>
</body>
</html>